# ç”µä¿¡å¥—é¤AIæ™ºèƒ½å®¢æœé—®é¢˜æœé›†

## ä¸€. NLUç³»ç»Ÿæ„å›¾è¯†åˆ«çº¯é LLM

### 1 é—®é¢˜æè¿°ä¸æ ¹æºåˆ†æ

#### 1.1 é—®é¢˜æè¿°

> å¯¹äºè¿™ç§å®¢æœç›¸å…³çš„å¯¹è¯ï¼Œåœ¨nlué˜¶æ®µç»™åˆ°llmçš„ï¼Œæ€»æ˜¯ä¼šå‡ºç°llmè¯†åˆ«æ„å›¾å‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥åˆ°åº•æ˜¯æˆ‘ä»¬è®¾è®¡å­˜åœ¨é—®é¢˜ï¼Œè¿˜æ˜¯llmèƒ½åŠ›é—®é¢˜ã€‚æœ‰æ²¡æœ‰åœ¨nlué˜¶æ®µè¯·æ±‚llmä¹‹å‰ï¼Œæ›´èƒ½æ™ºèƒ½çš„æç¤ºç»™åˆ°llmï¼Œè¿™ä¸ªè¦æ€ä¹ˆåšï¼Ÿè¿˜æ˜¯å®Œå…¨ä¸¢ç»™llmå»è¯†åˆ«æ„å›¾å‘¢?è¿˜æ˜¯è¯´æç¤ºè¯å¾ˆå…³é”®ï¼Ÿè¿˜æœ‰æˆç†Ÿçš„ç”µä¿¡è¿è¥å•†å®¢æœæ€ä¹ˆåšåˆ°è¿™ä¹ˆæ™ºèƒ½çš„ï¼Œç®€å•å¯¹è¯æˆ–è€…å¾ˆå¸¸ç”¨çš„å¯¹è¯å°±èƒ½è¯†åˆ«æ„å›¾å‘¢ï¼Ÿ

ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œè¿™æ¶‰åŠåˆ°NLUç³»ç»Ÿè®¾è®¡çš„æ ¸å¿ƒï¼š

1. **é—®é¢˜æœ¬è´¨**ï¼šLLMåœ¨æ„å›¾è¯†åˆ«ä¸Šå‡ºé”™ï¼Œåˆ°åº•æ˜¯ç³»ç»Ÿè®¾è®¡é—®é¢˜è¿˜æ˜¯LLMèƒ½åŠ›é—®é¢˜ï¼Ÿ
2. **è§£å†³æ–¹å‘**ï¼šå¦‚ä½•æ›´æ™ºèƒ½åœ°æç¤ºLLMï¼Ÿ
3. **è¡Œä¸šå®è·µ**ï¼šæˆç†Ÿçš„ç”µä¿¡å®¢æœç³»ç»Ÿæ˜¯å¦‚ä½•åšçš„ï¼Ÿ

#### 1.2. é—®é¢˜æ ¹æºåˆ†æ

#### 1.2.1 å½“å‰æ–¹æ¡ˆçš„é—®é¢˜

å½“å‰ç³»ç»Ÿé‡‡ç”¨çš„æ˜¯**çº¯LLMæ–¹æ¡ˆ**ï¼š

> ç”¨æˆ·è¾“å…¥ â†’ LLM Function Calling â†’ æ„å›¾ + æ§½ä½

**é—®é¢˜**ï¼š

- âŒ å®Œå…¨ä¾èµ–LLMç†è§£èƒ½åŠ›
- âŒ å¯¹ç»†å¾®å·®å¼‚æ•æ„Ÿåº¦ä¸å¤Ÿï¼ˆ"æˆ‘è¦åŠç†" vs "æ€ä¹ˆåŠç†"ï¼‰
- âŒ Promptå†è¯¦ç»†ä¹Ÿéš¾ä»¥è¦†ç›–æ‰€æœ‰è¾¹ç•Œæƒ…å†µ
- âŒ æˆæœ¬é«˜ã€å»¶è¿Ÿå¤§

#### 1.2.2 LLMçš„å±€é™æ€§

**LLMä¸æ“…é•¿çš„**ï¼š

- ç²¾ç¡®çš„è§„åˆ™æ‰§è¡Œï¼ˆå¦‚"å¿…é¡»åŒ…å«å…·ä½“å¥—é¤åæ‰æ˜¯change_package"ï¼‰
- ç»†å¾®çš„è¯­ä¹‰å·®å¼‚ï¼ˆ"æˆ‘è¦"æ˜¯åŠ¨ä½œï¼Œ"æ€ä¹ˆ"æ˜¯å’¨è¯¢ï¼‰
- é«˜ä¸€è‡´æ€§è¦æ±‚ï¼ˆåŒæ ·è¾“å…¥æ¯æ¬¡ç»“æœä¸€è‡´ï¼‰

**LLMæ“…é•¿çš„**ï¼š

- æ¨¡ç³Šè¯­ä¹‰ç†è§£
- å¤æ‚ä¸Šä¸‹æ–‡æ¨ç†
- å¼€æ”¾åŸŸå¯¹è¯

### 2. æˆç†Ÿç”µä¿¡å®¢æœçš„å®é™…åšæ³•

æˆç†Ÿç³»ç»Ÿé€šå¸¸é‡‡ç”¨**æ··åˆæ¶æ„**ï¼ˆHybrid Approachï¼‰ï¼š

#### 2.1 æ–¹æ¡ˆAï¼šè§„åˆ™å‰ç½® + LLMå…œåº•

```
ç”¨æˆ·è¾“å…¥
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è§„åˆ™å¼•æ“       â”‚ â† 80%é«˜é¢‘åœºæ™¯ï¼Œæ¯«ç§’çº§å“åº”
â”‚  (æ­£åˆ™+å…³é”®è¯)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“ (å‘½ä¸­) or (æœªå‘½ä¸­)
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ LLM NLUâ”‚ â† 20%å¤æ‚åœºæ™¯ï¼Œå…œåº•
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   æ„å›¾ + æ§½ä½
```

**ä¼˜ç‚¹**ï¼š

- âœ… é«˜é¢‘åœºæ™¯å¿«é€Ÿå‡†ç¡®ï¼ˆè§„åˆ™ï¼‰
- âœ… å¤æ‚åœºæ™¯çµæ´»å¤„ç†ï¼ˆLLMï¼‰
- âœ… æˆæœ¬å¯æ§ï¼ˆ80%è§„åˆ™ï¼Œ20%LLMï¼‰

#### 2.2 æ–¹æ¡ˆBï¼šæ„å›¾åˆ†ç±»å™¨ + LLMæ§½ä½æå–

```
ç”¨æˆ·è¾“å…¥
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è½»é‡çº§åˆ†ç±»å™¨     â”‚ â† BERT/RoBERTaå¾®è°ƒ
â”‚ (æ„å›¾åˆ†ç±»)       â”‚    å‡†ç¡®ç‡95%+
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLMæ§½ä½æå–      â”‚ â† åªè´Ÿè´£å®ä½“è¯†åˆ«
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
æ„å›¾ + æ§½ä½
```

**ä¼˜ç‚¹**ï¼š

- âœ… æ„å›¾åˆ†ç±»é«˜å‡†ç¡®ç‡
- âœ… LLMä¸“æ³¨æ§½ä½æå–
- âœ… å„å¸å…¶èŒï¼Œæ•ˆæœæ›´å¥½

### 3. è§„åˆ™å¼•æ“æ”¹è¿›NLUæ–¹æ¡ˆ

**é‡‡ç”¨æ–¹æ¡ˆAï¼šè§„åˆ™å‰ç½® + LLMå…œåº•**

åœ¨NLUå¼•æ“å‰åŠ ä¸€å±‚**è§„åˆ™é¢„å¤„ç†**ï¼š

```python
# core/nlu/rule_preprocessor.py
"""
è§„åˆ™é¢„å¤„ç†å™¨ - å¤„ç†é«˜é¢‘ã€æ˜ç¡®çš„åœºæ™¯
"""
import re
from typing import Optional, Dict, Any

class RulePreprocessor:
    """è§„åˆ™é¢„å¤„ç†å™¨"""
    
    def __init__(self):
        # å¥—é¤åç§°
        self.package_names = ["ç»æµå¥—é¤", "ç•…æ¸¸å¥—é¤", "æ— é™å¥—é¤", "æ ¡å›­å¥—é¤"]
        
        # é«˜é¢‘è§„åˆ™
        self.rules = [
            # è§„åˆ™1: åŠç†å…·ä½“å¥—é¤
            {
                "pattern": r"(åŠç†|æ¢æˆ|æ›´æ¢|å˜æ›´|æˆ‘è¦åŠç†|å¸®æˆ‘åŠç†).*?(ç»æµå¥—é¤|ç•…æ¸¸å¥—é¤|æ— é™å¥—é¤|æ ¡å›­å¥—é¤)",
                "intent": "change_package",
                "extract": ["new_package_name", "phone"]
            },
            # è§„åˆ™2: åŠç†å¥—é¤ï¼ˆæ— å…·ä½“åï¼‰
            {
                "pattern": r"^(æˆ‘è¦|æƒ³è¦|æƒ³|å¸®æˆ‘|ç»™æˆ‘).*?(åŠç†|åŠä¸ª|å¼€é€š|æ¢).*?å¥—é¤$",
                "intent": "query_packages",
                "extract": []
            },
            # è§„åˆ™3: å’¨è¯¢åŠç†æµç¨‹
            {
                "pattern": r"(æ€ä¹ˆ|å¦‚ä½•|æ€æ ·).*(åŠç†|å¼€é€š|æ¢)",
                "intent": "business_consultation",
                "extract": ["question"]
            },
            # è§„åˆ™4: æŸ¥è¯¢å½“å‰å¥—é¤
            {
                "pattern": r"(æˆ‘çš„|å½“å‰|ç°åœ¨).*(å¥—é¤|æ˜¯ä»€ä¹ˆå¥—é¤|ç”¨çš„ä»€ä¹ˆ)",
                "intent": "query_current_package",
                "extract": ["phone"]
            },
            # è§„åˆ™5: æŸ¥è¯¢æµé‡
            {
                "pattern": r"(ç”¨äº†|å‰©ä½™|è¿˜æœ‰).*(å¤šå°‘|å‡ ä¸ª).*?(æµé‡|G)",
                "intent": "query_usage",
                "extract": ["phone"]
            }
        ]
    
    def preprocess(self, user_input: str, context: Dict) -> Optional[Dict[str, Any]]:
        """
        è§„åˆ™é¢„å¤„ç†
        
        Returns:
            Dict: å¦‚æœè§„åˆ™å‘½ä¸­ï¼Œè¿”å› {intent, parameters}
            None: å¦‚æœè§„åˆ™æœªå‘½ä¸­ï¼Œè¿”å›Noneï¼ˆäº¤ç»™LLMï¼‰
        """
        for rule in self.rules:
            match = re.search(rule["pattern"], user_input, re.IGNORECASE)
            if match:
                # å‘½ä¸­è§„åˆ™
                intent = rule["intent"]
                parameters = self._extract_parameters(
                    user_input, 
                    match, 
                    rule["extract"],
                    context
                )
                
                return {
                    "intent": intent,
                    "parameters": parameters,
                    "source": "rule",  # æ ‡è®°æ¥æº
                    "confidence": 0.95
                }
        
        return None  # æœªå‘½ä¸­ï¼Œäº¤ç»™LLM
    
    def _extract_parameters(self, text: str, match, extract_list: list, context: Dict) -> Dict:
        """æå–å‚æ•°"""
        params = {}
        
        # æå–å¥—é¤å
        if "new_package_name" in extract_list or "package_name" in extract_list:
            for pkg in self.package_names:
                if pkg in text:
                    key = "new_package_name" if "new_package_name" in extract_list else "package_name"
                    params[key] = pkg
                    break
        
        # æå–æ‰‹æœºå·
        if "phone" in extract_list:
            phone_match = re.search(r'1[3-9]\d{9}', text)
            if phone_match:
                params["phone"] = phone_match.group()
            elif context.get("user_phone"):
                params["phone"] = context["user_phone"]
        
        # æå–å’¨è¯¢é—®é¢˜
        if "question" in extract_list:
            params["question"] = text
        
        return params
```

### é›†æˆåˆ°NLUå¼•æ“

ä¿®æ”¹ `core/nlu/nlu_engine.py`ï¼š

```python
class NLUEngine:
    def __init__(self):
        # ... åŸæœ‰ä»£ç 
        self.rule_preprocessor = RulePreprocessor()  # æ–°å¢
    
    def understand(self, user_input: str, session_id: str, user_phone: Optional[str] = None):
        logger.info(f"[{session_id}] å¼€å§‹NLUç†è§£: {user_input}")
        
        try:
            # 1. é¢„å¤„ç†
            processed_text = self._preprocess(user_input)
            
            # 2. è·å–ä¸Šä¸‹æ–‡
            context = self._get_session_context(session_id)
            if user_phone:
                context["user_phone"] = user_phone
            
            # ğŸ†• 3. è§„åˆ™é¢„å¤„ç†ï¼ˆæ–°å¢ï¼‰
            rule_result = self.rule_preprocessor.preprocess(processed_text, context)
            if rule_result:
                logger.info(f"[{session_id}] è§„åˆ™å‘½ä¸­: {rule_result['intent']}")
                
                # è½¬æ¢ä¸ºNLUResult
                nlu_result = NLUResult(
                    intent=rule_result["intent"],
                    function_name=rule_result["intent"],
                    parameters=rule_result["parameters"],
                    confidence=rule_result["confidence"]
                )
                
                # éªŒè¯å‚æ•°å®Œæ•´æ€§
                missing_slots = self._validate_parameters(
                    nlu_result.function_name,
                    nlu_result.parameters,
                    context
                )
                
                if missing_slots:
                    nlu_result.requires_clarification = True
                    nlu_result.clarification_message = self._get_slot_question(missing_slots[0])
                    nlu_result.missing_slots = missing_slots
                
                self._update_session(session_id, user_input, nlu_result, context)
                return nlu_result
            
            # 4. è§„åˆ™æœªå‘½ä¸­ï¼Œè°ƒç”¨LLMï¼ˆåŸæœ‰é€»è¾‘ï¼‰
            logger.info(f"[{session_id}] è§„åˆ™æœªå‘½ä¸­ï¼Œä½¿ç”¨LLM")
            # ... åŸæœ‰LLMè°ƒç”¨ä»£ç 
```

æ•ˆæœå¯¹æ¯”

| ç”¨æˆ·è¾“å…¥              | è§„åˆ™å‰ç½®                  | çº¯LLM                     | å“åº”æ—¶é—´     |
| --------------------- | ------------------------- | ------------------------- | ------------ |
| "æˆ‘è¦åŠç†å¥—é¤"        | âœ… `query_packages`        | âŒ `business_consultation` | 5ms vs 500ms |
| "åŠç†ç»æµå¥—é¤"        | âœ… `change_package`        | âœ… `change_package`        | 5ms vs 500ms |
| "æ€ä¹ˆåŠç†å¥—é¤"        | âœ… `business_consultation` | âœ… `business_consultation` | 5ms vs 500ms |
| "å¸®æˆ‘æŸ¥ä¸‹100å…ƒçš„å¥—é¤" | âŒ æœªå‘½ä¸­ â†’ LLM            | âœ… `query_packages`        | 500ms        |

### 4 Promptä¼˜åŒ–æŠ€å·§

å¦‚æœåšæŒçº¯LLMæ–¹æ¡ˆï¼Œè¿™é‡Œæœ‰**Promptä¼˜åŒ–çš„æœ€ä½³å®è·µ**ï¼š

##### 4.1 æŠ€å·§ä¸€ Few-Shot Learningï¼ˆæœ€æœ‰æ•ˆï¼‰â­

åœ¨Promptä¸­åŠ å…¥**å…·ä½“ç¤ºä¾‹**ï¼š

```
SYSTEM_PROMPT_WITH_EXAMPLES = """ä½ æ˜¯ç”µä¿¡å®¢æœAIï¼Œè´Ÿè´£ç†è§£ç”¨æˆ·éœ€æ±‚å¹¶è°ƒç”¨ç›¸åº”å‡½æ•°ã€‚

ã€ç¤ºä¾‹å­¦ä¹ ã€‘â­ éå¸¸é‡è¦
è¯·å‚è€ƒä»¥ä¸‹ç¤ºä¾‹æ¥ç†è§£å¦‚ä½•è¯†åˆ«æ„å›¾ï¼š

ç¤ºä¾‹1 - åŠç†å…·ä½“å¥—é¤ï¼š
ç”¨æˆ·ï¼š"æˆ‘è¦åŠç†ç»æµå¥—é¤"
â†’ change_package(new_package_name="ç»æµå¥—é¤")

ç¤ºä¾‹2 - åŠç†å¥—é¤ï¼ˆæ— å…·ä½“åï¼‰ï¼š
ç”¨æˆ·ï¼š"æˆ‘è¦åŠç†å¥—é¤"
â†’ query_packages() [å±•ç¤ºåˆ—è¡¨è®©ç”¨æˆ·é€‰æ‹©]

ç¤ºä¾‹3 - å’¨è¯¢åŠç†ï¼š
ç”¨æˆ·ï¼š"æ€ä¹ˆåŠç†å¥—é¤"
â†’ business_consultation(question="æ€ä¹ˆåŠç†å¥—é¤")

ç¤ºä¾‹4 - æŸ¥è¯¢å½“å‰ï¼š
ç”¨æˆ·ï¼š"æˆ‘çš„å¥—é¤æ˜¯ä»€ä¹ˆ"
â†’ query_current_package(phone="éœ€è¦è¯¢é—®")

ç¤ºä¾‹5 - ä¸Šä¸‹æ–‡åŠç†ï¼š
ä¸Šä¸‹æ–‡ï¼šç”¨æˆ·åˆšæŸ¥è¯¢"æ ¡å›­å¥—é¤è¯¦æƒ…"
ç”¨æˆ·ï¼š"åŠç†ï¼Œ13800138000"
â†’ change_package(new_package_name="æ ¡å›­å¥—é¤", phone="13800138000")

ã€æ ¸å¿ƒåŸåˆ™ã€‘
1. æœ‰å…·ä½“å¥—é¤å + åŠç†åŠ¨è¯ â†’ change_package
2. æ— å…·ä½“å¥—é¤å + åŠç†åŠ¨è¯ â†’ query_packages
3. ç–‘é—®è¯ï¼ˆæ€ä¹ˆã€å¦‚ä½•ï¼‰+ åŠç† â†’ business_consultation

... [å…¶ä½™è§„åˆ™]
"""
```

#### 4.2 æŠ€å·§äºŒ Chain-of-Thoughtï¼ˆæ€ç»´é“¾ï¼‰

è®©LLM"æ€è€ƒ"åå†å†³ç­–ï¼š

```
SYSTEM_PROMPT_WITH_COT = """
ã€å†³ç­–æ­¥éª¤ã€‘â­
åœ¨è°ƒç”¨å‡½æ•°å‰ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ€è€ƒï¼š

æ­¥éª¤1: è¯†åˆ«å…³é”®è¯
- æ˜¯å¦åŒ…å«ç–‘é—®è¯ï¼ˆæ€ä¹ˆã€å¦‚ä½•ï¼‰ï¼Ÿ
- æ˜¯å¦åŒ…å«åŠ¨ä½œè¯ï¼ˆæˆ‘è¦ã€åŠç†ï¼‰ï¼Ÿ
- æ˜¯å¦åŒ…å«å…·ä½“å¥—é¤åï¼Ÿ

æ­¥éª¤2: åˆ¤æ–­æ„å›¾
- æœ‰ç–‘é—®è¯ â†’ å’¨è¯¢ç±»
- æœ‰åŠ¨ä½œè¯ + å…·ä½“å¥—é¤ â†’ åŠç†ç±»
- æœ‰åŠ¨ä½œè¯ + æ— å…·ä½“å¥—é¤ â†’ æŸ¥è¯¢ç±»

æ­¥éª¤3: è°ƒç”¨å‡½æ•°
- æ ¹æ®æ­¥éª¤2çš„åˆ¤æ–­ï¼Œé€‰æ‹©å¯¹åº”å‡½æ•°
"""
```

#### 4.3 æŠ€å·§ä¸‰ è´Ÿé¢ç¤ºä¾‹ï¼ˆå‘Šè¯‰LLMä¸è¦åšä»€ä¹ˆï¼‰

```
ã€é”™è¯¯ç¤ºä¾‹ - è¯·é¿å…ã€‘âŒ

é”™è¯¯1:
ç”¨æˆ·ï¼š"æˆ‘è¦åŠç†å¥—é¤"
âŒ change_package() [å‚æ•°ç¼ºå¤±ï¼Œä¼šå¯¼è‡´è¿½é—®]
âœ… query_packages() [å±•ç¤ºåˆ—è¡¨]

é”™è¯¯2:
ç”¨æˆ·ï¼š"æ€ä¹ˆåŠç†ç»æµå¥—é¤"
âŒ change_package(new_package_name="ç»æµå¥—é¤")
âœ… business_consultation(question="æ€ä¹ˆåŠç†ç»æµå¥—é¤")

é”™è¯¯3:
ç”¨æˆ·ï¼š"åŠç†"ï¼ˆæ— ä¸Šä¸‹æ–‡ï¼‰
âŒ change_package()
âœ… query_packages() [ç¼ºå°‘å¥—é¤ä¿¡æ¯]
"""
```

### 5. æœ€ä½³å®è·µå»ºè®®

#### çŸ­æœŸæ–¹æ¡ˆï¼ˆç«‹å³å¯ç”¨ï¼‰

1. âœ… **åŠ è§„åˆ™å‰ç½®**ï¼ˆæ–¹æ¡ˆ1ï¼‰ï¼š80%é«˜é¢‘åœºæ™¯ç”¨è§„åˆ™
2. âœ… **ä¼˜åŒ–Prompt**ï¼ˆFew-Shot + è´Ÿé¢ç¤ºä¾‹ï¼‰ï¼šæå‡LLMå‡†ç¡®ç‡åˆ°90%+
3. âœ… **åŠ åéªŒè¯**ï¼šLLMç»“æœé€šè¿‡è§„åˆ™äºŒæ¬¡éªŒè¯

#### ä¸­æœŸæ–¹æ¡ˆï¼ˆ1-2ä¸ªæœˆï¼‰

1. âœ… **è®­ç»ƒæ„å›¾åˆ†ç±»å™¨**ï¼šBERTæ¨¡å‹ï¼Œå‡†ç¡®ç‡95%+
2. âœ… **æ”¶é›†çœŸå®æ•°æ®**ï¼šæ ‡æ³¨500-1000æ¡å¯¹è¯ï¼ŒæŒç»­ä¼˜åŒ–

#### é•¿æœŸæ–¹æ¡ˆï¼ˆ3-6ä¸ªæœˆï¼‰

1. âœ… **ç«¯åˆ°ç«¯ä¼˜åŒ–**ï¼šRASA / Botpressæ¡†æ¶
2. âœ… **å¼ºåŒ–å­¦ä¹ **ï¼šæ ¹æ®ç”¨æˆ·åé¦ˆä¸æ–­ä¼˜åŒ–



### 6. æˆæœ¬å’Œå‡†ç¡®ç‡

| æ–¹æ¡ˆ       | å‡†ç¡®ç‡ | å“åº”æ—¶é—´ | æˆæœ¬ | ç»´æŠ¤æˆæœ¬ |
| ---------- | ------ | -------- | ---- | -------- |
| çº¯LLM      | 75-85% | 500ms    | é«˜   | ä½       |
| è§„åˆ™+LLMâ­  | 90-95% | 50ms     | ä¸­   | ä¸­       |
| åˆ†ç±»å™¨+LLM | 95-98% | 100ms    | ä¸­   | é«˜       |
| RASAæ¡†æ¶   | 98%+   | 10ms     | ä½   | é«˜       |

## äºŒã€è§„æ¨¡åŒ–åœºæ™¯çš„å®¢æœç³»ç»Ÿ

### 1 é—®é¢˜æè¿°

> å¦‚æœæˆ‘ä»¬æä¾›çš„funtion å¤Ÿå¤š,æˆ–è€…æä¾›çš„å¥—é¤å¾ˆå¤šæ¯”å¦‚1w+è¿™ç§çš„,è¿™ç§çš„åˆ°åº•æ€ä¹ˆåš?è¿˜æœ‰æˆç†Ÿçš„å®¢æœaiç³»ç»Ÿä¼šæ€ä¹ˆåšå‘¢?

å³ï¼š

> è§„æ¨¡åŒ–åœºæ™¯ä¸‹çš„å®é™…æŒ‘æˆ˜ï¼š
>
> 1. **Functionå¾ˆå¤š**ï¼šæ¯”å¦‚æœ‰å‡ åä¸ªã€ä¸Šç™¾ä¸ªæ„å›¾
> 2. **å®ä½“å¾ˆå¤š**ï¼šæ¯”å¦‚1ä¸‡+å¥—é¤
> 3. **è§„åˆ™çˆ†ç‚¸**ï¼šå¦‚ä½•é¿å…è§„åˆ™æ•°é‡æŒ‡æ•°çº§å¢é•¿

### 2. è§„æ¨¡åŒ–åœºæ™¯çš„æ ¸å¿ƒæŒ‘æˆ˜

#### 2.1 é—®é¢˜åœºæ™¯

| åœºæ™¯   | è§„æ¨¡          | ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜           |
| ------ | ------------- | ------------------------ |
| æ„å›¾å¤š | 50-100+ä¸ªæ„å›¾ | âŒ è§„åˆ™çˆ†ç‚¸ï¼ŒPromptå¤ªé•¿   |
| å®ä½“å¤š | 1ä¸‡+å¥—é¤      | âŒ æ— æ³•æšä¸¾ï¼Œå†…å­˜çˆ†ç‚¸     |
| ç»„åˆå¤š | æ„å›¾Ã—å®ä½“     | âŒ è§„åˆ™ç»´æŠ¤æˆæœ¬æŒ‡æ•°çº§å¢é•¿ |

**ä¾‹å­**ï¼š

- ä¸­å›½ç§»åŠ¨æœ‰**å‡ ç™¾ä¸ªå¥—é¤**ï¼ˆä¸åŒåœ°åŒºã€ä¸åŒç±»å‹ï¼‰
- æ„å›¾æœ‰**50+ç§**ï¼ˆæŸ¥è¯¢ã€åŠç†ã€é€€è®¢ã€æŠ•è¯‰ã€å’¨è¯¢ã€æŠ€æœ¯æ”¯æŒ...ï¼‰
- å¦‚æœç”¨è§„åˆ™ï¼š50æ„å›¾ Ã— 100å¥—é¤ = 5000æ¡è§„åˆ™ âŒ

### 3 æˆç†Ÿå®¢æœAIçš„å®é™…æ¶æ„ â­

**å…³é”®æŠ€æœ¯ï¼š**

1. **åˆ†å±‚æ„å›¾è¯†åˆ«**ï¼ˆIntent Hierarchyï¼‰

2. **å®ä½“é“¾æ¥**ï¼ˆEntity Linkingï¼‰

3. **å‘é‡æ£€ç´¢**ï¼ˆVector Searchï¼‰

4. **æ··åˆæ¶æ„**

#### 3.1 åˆ†å±‚æ¶æ„

```
ç”¨æˆ·è¾“å…¥
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: ç²—ç²’åº¦æ„å›¾åˆ†ç±»å™¨         â”‚ â† BERT/RoBERTa
â”‚ (ä¸€çº§æ„å›¾ï¼šæŸ¥è¯¢/åŠç†/å’¨è¯¢/æŠ•è¯‰)   â”‚    10-20ä¸ªå¤§ç±»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: ç»†ç²’åº¦æ„å›¾è¯†åˆ«           â”‚ â† è§„åˆ™ + LLM
â”‚ (äºŒçº§æ„å›¾ï¼šå¥—é¤æŸ¥è¯¢/æµé‡æŸ¥è¯¢/...)  â”‚    50-100ä¸ªå°ç±»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: å®ä½“è¯†åˆ« + é“¾æ¥          â”‚ â† NER + å‘é‡æ£€ç´¢
â”‚ (å¥—é¤åã€æ‰‹æœºå·ã€æ—¥æœŸ...)         â”‚    å¤„ç†1ä¸‡+å®ä½“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: æ§½ä½å¡«å……                 â”‚ â† LLM
â”‚ (å‚æ•°éªŒè¯ã€è¡¥å…¨)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
ç»“æ„åŒ–è¾“å‡º
```

### 4. å…·ä½“æŠ€æœ¯æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1: åˆ†å±‚æ„å›¾è¯†åˆ« â­ æ ¸å¿ƒ

##### 4.1.1 ä¸€çº§æ„å›¾ï¼ˆç²—ç²’åº¦ï¼‰

**ç›®æ ‡**ï¼šå¿«é€Ÿåˆ†ç±»åˆ°å¤§ç±»ï¼Œ10-20ä¸ªä¸€çº§æ„å›¾

```python
# core/nlu/intent_classifier.py
"""
ä¸€çº§æ„å›¾åˆ†ç±»å™¨ - ä½¿ç”¨BERTå¾®è°ƒæˆ–è§„åˆ™
"""

class Level1IntentClassifier:
    """ä¸€çº§æ„å›¾åˆ†ç±»å™¨"""
    
    # ä¸€çº§æ„å›¾ï¼ˆå¤§ç±»ï¼‰
    LEVEL1_INTENTS = {
        "query": ["æŸ¥è¯¢", "æŸ¥", "çœ‹", "æœ‰ä»€ä¹ˆ", "å¤šå°‘"],
        "transaction": ["åŠç†", "æ¢", "æ”¹", "å‡çº§", "å–æ¶ˆ"],
        "consultation": ["æ€ä¹ˆ", "å¦‚ä½•", "ä»€ä¹ˆæ¡ä»¶", "æµç¨‹"],
        "complaint": ["æŠ•è¯‰", "åé¦ˆ", "ä¸æ»¡æ„", "é—®é¢˜"],
        "greeting": ["ä½ å¥½", "åœ¨å—", "æ‚¨å¥½"],
    }
    
    def classify(self, user_input: str) -> str:
        """
        å¿«é€Ÿåˆ†ç±»åˆ°ä¸€çº§æ„å›¾
        
        Returns:
            str: ä¸€çº§æ„å›¾ï¼ˆquery/transaction/consultationç­‰ï¼‰
        """
        # æ–¹æ³•1: ç®€å•å…³é”®è¯åŒ¹é…ï¼ˆå¿«é€Ÿï¼‰
        for intent, keywords in self.LEVEL1_INTENTS.items():
            if any(kw in user_input for kw in keywords):
                return intent
        
        # æ–¹æ³•2: BERTåˆ†ç±»å™¨ï¼ˆå‡†ç¡®ï¼Œéœ€è®­ç»ƒï¼‰
        # return self.bert_classifier.predict(user_input)
        
        return "unknown"
```

##### 4.1.2 äºŒçº§æ„å›¾ï¼ˆç»†ç²’åº¦ï¼‰

**æ ¹æ®ä¸€çº§æ„å›¾ï¼Œè¿›ä¸€æ­¥ç»†åˆ†**ï¼š

```python
class Level2IntentClassifier:
    """äºŒçº§æ„å›¾åˆ†ç±»å™¨"""
    
    # äºŒçº§æ„å›¾æ˜ å°„
    LEVEL2_INTENTS = {
        "query": {
            "å¥—é¤": "query_packages",
            "æµé‡": "query_usage",
            "æˆ‘çš„": "query_current_package",
            "ä½™é¢": "query_balance"
        },
        "transaction": {
            "åŠç†": "change_package",
            "å–æ¶ˆ": "cancel_service",
            "å‡çº§": "upgrade_package"
        },
        "consultation": {
            "åŠç†": "business_consultation",
            "æ¡ä»¶": "requirement_consultation"
        }
    }
    
    def classify(self, user_input: str, level1_intent: str) -> str:
        """
        åŸºäºä¸€çº§æ„å›¾ï¼Œåˆ†ç±»åˆ°äºŒçº§æ„å›¾
        
        Args:
            user_input: ç”¨æˆ·è¾“å…¥
            level1_intent: ä¸€çº§æ„å›¾
        
        Returns:
            str: äºŒçº§æ„å›¾ï¼ˆå…·ä½“çš„function nameï¼‰
        """
        if level1_intent not in self.LEVEL2_INTENTS:
            return "unknown"
        
        # åœ¨è¯¥å¤§ç±»ä¸‹åŒ¹é…å…³é”®è¯
        for keyword, intent in self.LEVEL2_INTENTS[level1_intent].items():
            if keyword in user_input:
                return intent
        
        # æœªåŒ¹é…ï¼Œä½¿ç”¨LLMå…œåº•
        return None  # è¡¨ç¤ºéœ€è¦LLM
```

**ä¼˜ç‚¹**ï¼š

- âœ… æ„å›¾ç©ºé—´ç¼©å°ï¼ˆä»100ä¸ª â†’ 10ä¸ª â†’ å…·ä½“æ„å›¾ï¼‰
- âœ… è§„åˆ™å¤æ‚åº¦é™ä½ï¼ˆåˆ†æ²»æ€æƒ³ï¼‰
- âœ… å¯ç»´æŠ¤æ€§å¼º

#### æ–¹æ¡ˆ2ï¼šå®ä½“è¯†åˆ« + å‘é‡æ£€ç´¢ â­ å¤„ç†1ä¸‡+å®ä½“

##### 4.2.1 æ ¸å¿ƒæ€è·¯

**é—®é¢˜**ï¼š1ä¸‡+å¥—é¤ï¼Œæ— æ³•æšä¸¾

**è§£å†³**ï¼šå‘é‡æ£€ç´¢ï¼ˆSemantic Searchï¼‰

```
ç”¨æˆ·ï¼š"æˆ‘è¦åŠç†ç•…æƒ³å¥—é¤"
            â†“
      [Embeddingæ¨¡å‹]
            â†“
      å‘é‡ï¼š[0.12, -0.34, ...]
            â†“
    [å‘é‡æ•°æ®åº“æŸ¥è¯¢]
            â†“
  æœ€ç›¸ä¼¼å¥—é¤ï¼š"ç•…æ¸¸å¥—é¤" (0.95)
            â†“
      è‡ªåŠ¨çº é”™ + æ¨¡ç³ŠåŒ¹é…
```

##### 4.2.2 å®ç°ä»£ç 

```python
# core/nlu/entity_linker.py
"""
å®ä½“é“¾æ¥å™¨ - å¤„ç†1ä¸‡+å¥—é¤å
"""
from typing import Optional, List, Tuple
import numpy as np
from sentence_transformers import SentenceTransformer

class EntityLinker:
    """å®ä½“é“¾æ¥å™¨ - å‘é‡æ£€ç´¢"""
    
    def __init__(self, package_db_path: str):
        """
        Args:
            package_db_path: å¥—é¤æ•°æ®åº“è·¯å¾„
        """
        # 1. åŠ è½½Embeddingæ¨¡å‹
        self.model = SentenceTransformer('paraphrase-multilingual-MiniLM-L12-v2')
        
        # 2. åŠ è½½æ‰€æœ‰å¥—é¤ï¼ˆ1ä¸‡+ï¼‰
        self.packages = self._load_packages(package_db_path)
        
        # 3. é¢„è®¡ç®—æ‰€æœ‰å¥—é¤çš„å‘é‡ï¼ˆç¦»çº¿ï¼‰
        self.package_embeddings = self._compute_embeddings()
        
        print(f"âœ“ å®ä½“é“¾æ¥å™¨åŠ è½½å®Œæˆ: {len(self.packages)}ä¸ªå¥—é¤")
    
    def _load_packages(self, db_path: str) -> List[dict]:
        """ä»æ•°æ®åº“åŠ è½½æ‰€æœ‰å¥—é¤"""
        # å®é™…ç”Ÿäº§ä¸­ä»MySQLåŠ è½½
        from database.db_manager import db_manager
        
        query = "SELECT id, name, price, data_gb FROM packages"
        rows = db_manager.execute_query(query)
        
        packages = []
        for row in rows:
            packages.append({
                "id": row[0],
                "name": row[1],
                "price": row[2],
                "data_gb": row[3]
            })
        
        return packages
    
    def _compute_embeddings(self) -> np.ndarray:
        """é¢„è®¡ç®—æ‰€æœ‰å¥—é¤åçš„å‘é‡"""
        package_names = [pkg["name"] for pkg in self.packages]
        embeddings = self.model.encode(package_names)
        return embeddings
    
    def link_entity(self, user_input: str, threshold: float = 0.7) -> Optional[str]:
        """
        å®ä½“é“¾æ¥ - æ‰¾åˆ°æœ€åŒ¹é…çš„å¥—é¤å
        
        Args:
            user_input: ç”¨æˆ·è¾“å…¥ï¼ˆå¦‚"ç•…æƒ³å¥—é¤"ï¼‰
            threshold: ç›¸ä¼¼åº¦é˜ˆå€¼
        
        Returns:
            Optional[str]: æ ‡å‡†å¥—é¤åï¼ˆå¦‚"ç•…æ¸¸å¥—é¤"ï¼‰
        """
        # 1. è®¡ç®—ç”¨æˆ·è¾“å…¥çš„å‘é‡
        query_embedding = self.model.encode([user_input])[0]
        
        # 2. è®¡ç®—ä¸æ‰€æœ‰å¥—é¤çš„ç›¸ä¼¼åº¦
        similarities = np.dot(self.package_embeddings, query_embedding)
        
        # 3. æ‰¾åˆ°æœ€ç›¸ä¼¼çš„
        best_idx = np.argmax(similarities)
        best_score = similarities[best_idx]
        
        # 4. åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼
        if best_score >= threshold:
            return self.packages[best_idx]["name"]
        
        return None
    
    def fuzzy_search(self, user_input: str, top_k: int = 5) -> List[Tuple[str, float]]:
        """
        æ¨¡ç³Šæœç´¢ - è¿”å›æœ€ç›¸ä¼¼çš„top_kä¸ªå¥—é¤
        
        Returns:
            List[Tuple[str, float]]: [(å¥—é¤å, ç›¸ä¼¼åº¦), ...]
        """
        query_embedding = self.model.encode([user_input])[0]
        similarities = np.dot(self.package_embeddings, query_embedding)
        
        # Top-K
        top_indices = np.argsort(similarities)[-top_k:][::-1]
        
        results = []
        for idx in top_indices:
            results.append((
                self.packages[idx]["name"],
                float(similarities[idx])
            ))
        
        return results
```

##### 4.2.3 é›†æˆåˆ°nlu

```python
class NLUEngine:
    def __init__(self):
        # ... åŸæœ‰ä»£ç 
        self.entity_linker = EntityLinker("path/to/packages.db")  # æ–°å¢
    
    def _extract_slot_value(self, user_input: str, slot_name: str):
        """æ”¹è¿›çš„æ§½ä½æå– - æ”¯æŒ1ä¸‡+å¥—é¤"""
        
        # å¥—é¤åè¯†åˆ«ï¼ˆæ”¹è¿›ï¼‰
        if slot_name in ["package_name", "new_package_name"]:
            # æ–¹æ³•1: ç²¾ç¡®åŒ¹é…
            package_names = ["ç»æµå¥—é¤", "ç•…æ¸¸å¥—é¤", ...]
            for name in package_names:
                if name in user_input:
                    return name
            
            # æ–¹æ³•2: å‘é‡æ£€ç´¢ï¼ˆ1ä¸‡+å¥—é¤ï¼‰â­
            linked_name = self.entity_linker.link_entity(user_input)
            if linked_name:
                logger.info(f"å®ä½“é“¾æ¥æˆåŠŸ: {user_input} â†’ {linked_name}")
                return linked_name
            
            # æ–¹æ³•3: æ¨¡ç³Šæœç´¢ï¼ˆæä¾›å€™é€‰ï¼‰
            candidates = self.entity_linker.fuzzy_search(user_input, top_k=3)
            if candidates:
                logger.info(f"æ¨¡ç³ŠåŒ¹é…å€™é€‰: {candidates}")
                # å¯ä»¥è¿”å›å€™é€‰åˆ—è¡¨ï¼Œè®©ç”¨æˆ·é€‰æ‹©
                return None  # è§¦å‘æ¾„æ¸…
        
        # ... å…¶ä»–æ§½ä½
```

#### æ–¹æ¡ˆ3 ï¼šåŠ¨æ€Functionå®šä¹‰ â­ å¤„ç†å¤§é‡Function

##### 4.3.1 é—®é¢˜

**å¦‚æœæœ‰100+ä¸ªFunctionï¼Œæ— æ³•å…¨éƒ¨ä¼ ç»™LLMï¼ˆTokené™åˆ¶ï¼‰**

##### 4.3.2 è§£å†³æ–¹æ¡ˆ ï¼šåŠ¨æ€é€‰æ‹©ç›¸å…³Function

```python
# core/nlu/function_selector.py
"""
Functioné€‰æ‹©å™¨ - åŠ¨æ€é€‰æ‹©ç›¸å…³çš„Function
"""
from typing import List

class FunctionSelector:
    """åŠ¨æ€Functioné€‰æ‹©å™¨"""
    
    def __init__(self):
        # æ‰€æœ‰Functionï¼ˆ100+ä¸ªï¼‰
        self.all_functions = self._load_all_functions()
        
        # Functionåˆ†ç»„ï¼ˆæŒ‰ä¸šåŠ¡é¢†åŸŸï¼‰
        self.function_groups = {
            "package": ["query_packages", "query_package_detail", "change_package"],
            "usage": ["query_usage", "query_balance"],
            "service": ["cancel_service", "upgrade_package"],
            "complaint": ["submit_complaint", "query_complaint_status"],
            # ... æ›´å¤šåˆ†ç»„
        }
    
    def select_relevant_functions(self, user_input: str, level1_intent: str) -> List[dict]:
        """
        æ ¹æ®ä¸€çº§æ„å›¾ï¼Œé€‰æ‹©ç›¸å…³çš„Functionï¼ˆ5-10ä¸ªï¼‰
        
        Args:
            user_input: ç”¨æˆ·è¾“å…¥
            level1_intent: ä¸€çº§æ„å›¾
        
        Returns:
            List[dict]: ç›¸å…³çš„Functionå®šä¹‰åˆ—è¡¨
        """
        # ç­–ç•¥1: åŸºäºä¸€çº§æ„å›¾é€‰æ‹©
        if level1_intent == "query":
            relevant_names = self.function_groups["package"] + self.function_groups["usage"]
        elif level1_intent == "transaction":
            relevant_names = self.function_groups["package"] + self.function_groups["service"]
        elif level1_intent == "complaint":
            relevant_names = self.function_groups["complaint"]
        else:
            # é»˜è®¤è¿”å›é«˜é¢‘Function
            relevant_names = self.function_groups["package"]
        
        # ç­–ç•¥2: åŸºäºå…³é”®è¯è¿›ä¸€æ­¥è¿‡æ»¤
        # ...
        
        # è¿”å›Functionå®šä¹‰
        return [f for f in self.all_functions if f["function"]["name"] in relevant_names]
```

##### 4.3.3 é›†æˆ

```python
class NLUEngine:
    def __init__(self):
        # ... åŸæœ‰ä»£ç 
        self.function_selector = FunctionSelector()  # æ–°å¢
    
    def understand(self, user_input: str, session_id: str, user_phone: Optional[str] = None):
        # ... å‰ç½®æ­¥éª¤
        
        # ğŸ†• ä¸€çº§æ„å›¾åˆ†ç±»
        level1_intent = self.level1_classifier.classify(processed_text)
        
        # ğŸ†• åŠ¨æ€é€‰æ‹©ç›¸å…³Functionï¼ˆ5-10ä¸ªï¼Œè€Œä¸æ˜¯100+ä¸ªï¼‰
        relevant_functions = self.function_selector.select_relevant_functions(
            processed_text, 
            level1_intent
        )
        
        # ğŸ†• åªä¼ é€’ç›¸å…³Functionç»™LLM
        response = self.client.chat.completions.create(
            model=self.model,
            messages=messages,
            tools=relevant_functions,  # åªä¼ 5-10ä¸ªFunction
            tool_choice="auto",
            temperature=0.2
        )
        
        # ...
```

### 5 æˆç†Ÿç³»ç»Ÿçš„å®Œæ•´æ¶æ„å‚è€ƒ

#### 5.1 é˜¿é‡Œäº‘æ™ºèƒ½å®¢æœæ¶æ„ï¼ˆå‚è€ƒï¼‰

```
ç”¨æˆ·è¾“å…¥ï¼š"æˆ‘è¦åŠç†ç•…æƒ³å¥—é¤"
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é¢„å¤„ç†             â”‚ â† ASRçº é”™ã€åˆ†è¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ä¸€çº§æ„å›¾åˆ†ç±»å™¨     â”‚ â† FastText/BERT (10ms)
â”‚ â†’ transaction         â”‚    10-20ä¸ªå¤§ç±»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. NER + å®ä½“é“¾æ¥     â”‚ â† BiLSTM-CRF + å‘é‡æ£€ç´¢
â”‚ â†’ "ç•…æƒ³" â†’ "ç•…æ¸¸å¥—é¤" â”‚    1ä¸‡+å®ä½“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. äºŒçº§æ„å›¾è¯†åˆ«       â”‚ â† è§„åˆ™ + LLMå…œåº•
â”‚ â†’ change_package      â”‚    Functioné€‰æ‹©å™¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ§½ä½å¡«å……           â”‚ â† LLM
â”‚ â†’ {package, phone}    â”‚    ä¸Šä¸‹æ–‡ç®¡ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. å¯¹è¯ç®¡ç†           â”‚ â† DST + Policy
â”‚ â†’ ç¡®è®¤/æ‰§è¡Œ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. å½“å‰ç³»ç»Ÿæ”¹è¿›è·¯çº¿å›¾

#### 6.1 Phase 1: ç«‹å³å¯åšï¼ˆ1å‘¨ï¼‰â­

```
# 1. åŠ å…¥ä¸€çº§æ„å›¾åˆ†ç±»ï¼ˆå…³é”®è¯ç‰ˆï¼‰
# 2. åŠ¨æ€Functioné€‰æ‹©
# 3. ç®€å•çš„å®ä½“é“¾æ¥ï¼ˆç²¾ç¡®+æ¨¡ç³ŠåŒ¹é…ï¼‰

ä¼˜ç‚¹ï¼š
- âœ… é›¶è®­ç»ƒæˆæœ¬
- âœ… ç«‹å³æå‡å‡†ç¡®ç‡åˆ°90%
- âœ… æ”¯æŒ100+å¥—é¤
```

#### 6.2 Phase 2: çŸ­æœŸä¼˜åŒ–ï¼ˆ1ä¸ªæœˆï¼‰

```
# 1. è®­ç»ƒBERTæ„å›¾åˆ†ç±»å™¨ï¼ˆå‡†ç¡®ç‡95%+ï¼‰
# 2. æ¥å…¥å‘é‡æ•°æ®åº“ï¼ˆMilvus/Qdrantï¼‰
# 3. å®ä½“é“¾æ¥æ¨¡å‹ä¼˜åŒ–

ä¼˜ç‚¹ï¼š
- âœ… æ”¯æŒ1ä¸‡+å¥—é¤
- âœ… å‡†ç¡®ç‡95%+
- âœ… å“åº”æ—¶é—´<100ms
```

#### Phase 3: é•¿æœŸè§„åˆ’ï¼ˆ3-6ä¸ªæœˆï¼‰

```
# 1. ç«¯åˆ°ç«¯ä¼˜åŒ–ï¼ˆRASA/Botpressï¼‰
# 2. å¤šè½®å¯¹è¯ç®¡ç†
# 3. ä¸ªæ€§åŒ–æ¨è

ä¼˜ç‚¹ï¼š
- âœ… å‡†ç¡®ç‡98%+
- âœ… å®Œæ•´çš„å¯¹è¯èƒ½åŠ›
```

### 7. ç«‹å³å¯ç”¨çš„ä»£ç ï¼ˆpha se1ï¼‰

**å®Œæ•´çš„æ”¹è¿›ç‰ˆNLUå¼•æ“**

```python
# core/nlu/nlu_engine_v2.py
"""
æ”¹è¿›ç‰ˆNLUå¼•æ“ - æ”¯æŒå¤§è§„æ¨¡åœºæ™¯
"""

class NLUEngineV2:
    """æ”¹è¿›ç‰ˆNLUå¼•æ“"""
    
    def __init__(self):
        # åŸæœ‰ç»„ä»¶
        self.client = OpenAI(...)
        self.model = settings.DEEPSEEK_MODEL
        
        # ğŸ†• æ–°å¢ç»„ä»¶
        self.level1_classifier = Level1IntentClassifier()  # ä¸€çº§åˆ†ç±»
        self.level2_classifier = Level2IntentClassifier()  # äºŒçº§åˆ†ç±»
        self.entity_linker = EntityLinker("packages.db")   # å®ä½“é“¾æ¥
        self.function_selector = FunctionSelector()        # Functioné€‰æ‹©
    
    def understand(self, user_input: str, session_id: str, user_phone: Optional[str] = None):
        """æ”¹è¿›çš„ç†è§£æµç¨‹"""
        
        # 1. é¢„å¤„ç†
        processed = self._preprocess(user_input)
        
        # 2. ğŸ†• ä¸€çº§æ„å›¾åˆ†ç±»ï¼ˆå¿«é€Ÿåˆ†ç±»åˆ°å¤§ç±»ï¼‰
        level1_intent = self.level1_classifier.classify(processed)
        logger.info(f"ä¸€çº§æ„å›¾: {level1_intent}")
        
        # 3. ğŸ†• å®ä½“è¯†åˆ«ï¼ˆå¤„ç†1ä¸‡+å¥—é¤ï¼‰
        entities = self.entity_linker.extract_entities(processed)
        logger.info(f"å®ä½“: {entities}")
        
        # 4. ğŸ†• äºŒçº§æ„å›¾è¯†åˆ«
        level2_intent = self.level2_classifier.classify(processed, level1_intent)
        
        if level2_intent:
            # è§„åˆ™å‘½ä¸­ï¼Œç›´æ¥è¿”å›
            logger.info(f"äºŒçº§æ„å›¾ï¼ˆè§„åˆ™ï¼‰: {level2_intent}")
            return NLUResult(
                intent=level2_intent,
                function_name=level2_intent,
                parameters=entities,
                confidence=0.95
            )
        
        # 5. è§„åˆ™æœªå‘½ä¸­ï¼Œä½¿ç”¨LLMå…œåº•
        logger.info("ä½¿ç”¨LLMå…œåº•")
        
        # ğŸ†• åŠ¨æ€é€‰æ‹©ç›¸å…³Functionï¼ˆ5-10ä¸ªï¼‰
        relevant_functions = self.function_selector.select_relevant_functions(
            processed, level1_intent
        )
        
        # è°ƒç”¨LLM
        response = self.client.chat.completions.create(
            model=self.model,
            messages=self._build_messages(processed, context),
            tools=relevant_functions,  # åªä¼ ç›¸å…³Function
            tool_choice="auto",
            temperature=0.2
        )
        
        # ... è§£æå“åº”
```

### 7. å…³é”®æŠ€æœ¯é€‰å‹

| åœºæ™¯      | æ¨èæŠ€æœ¯      | å¼€æºæ–¹æ¡ˆ                 | å•†ä¸šæ–¹æ¡ˆ          |
| --------- | ------------- | ------------------------ | ----------------- |
| æ„å›¾åˆ†ç±»  | BERTå¾®è°ƒ      | HuggingFace Transformers | AWS Comprehend    |
| å®ä½“è¯†åˆ«  | BiLSTM-CRF    | spaCy                    | Google NLU        |
| å‘é‡æ£€ç´¢  | å‘é‡æ•°æ®åº“    | Milvus, Qdrant           | Pinecone          |
| Embedding | Sentence-BERT | sentence-transformers    | OpenAI Embeddings |
| å¯¹è¯ç®¡ç†  | DSTæ¡†æ¶       | RASA, Botpress           | é˜¿é‡Œäº‘æ™ºèƒ½å®¢æœ    |

### 8. æ€»ç»“

**æ ¸å¿ƒæ€æƒ³ï¼š**

1. âœ… **åˆ†å±‚é™ç»´**ï¼š100ä¸ªæ„å›¾ â†’ 10ä¸ªå¤§ç±» â†’ å…·ä½“æ„å›¾

2. âœ… **å‘é‡æ£€ç´¢**ï¼š1ä¸‡+å¥—é¤ â†’ Embedding + ç›¸ä¼¼åº¦æœç´¢

3. âœ… **åŠ¨æ€é€‰æ‹©**ï¼š100ä¸ªFunction â†’ 5-10ä¸ªç›¸å…³Function

4. âœ… **æ··åˆæ¶æ„**ï¼šè§„åˆ™ï¼ˆ80%ï¼‰ + åˆ†ç±»å™¨ï¼ˆ15%ï¼‰ + LLMï¼ˆ5%ï¼‰

**å®Œæ•´æ¶æ„å›¾**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·è¾“å…¥å±‚                          â”‚
â”‚                "æˆ‘è¦åŠç†ç•…æƒ³å¥—é¤"                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é¢„å¤„ç†å±‚ (10ms)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  ASRçº é”™  â”‚ â†’â”‚  åˆ†è¯    â”‚ â†’â”‚  å½’ä¸€åŒ–  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ğŸš€ ä¸€çº§æ„å›¾åˆ†ç±» (50ms) - å¿«é€Ÿåˆ†æµ              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  FastText/BERTåˆ†ç±»å™¨ (10-20ä¸ªå¤§ç±»)          â”‚        â”‚
â”‚  â”‚  - query     (æŸ¥è¯¢ç±»)                       â”‚        â”‚
â”‚  â”‚  - transaction (åŠç†ç±») âœ“                   â”‚        â”‚
â”‚  â”‚  - consultation (å’¨è¯¢ç±»)                    â”‚        â”‚
â”‚  â”‚  - complaint (æŠ•è¯‰ç±»)                       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ğŸ¯ å®ä½“è¯†åˆ« + é“¾æ¥ (30ms) - å¤„ç†æµ·é‡å®ä½“       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  NERæ¨¡å‹ (BiLSTM-CRF) + å‘é‡æ£€ç´¢             â”‚        â”‚
â”‚  â”‚  "ç•…æƒ³" â†’ Embedding â†’ ç›¸ä¼¼åº¦æœç´¢             â”‚        â”‚
â”‚  â”‚          â†’ "ç•…æ¸¸å¥—é¤" (0.95ç›¸ä¼¼åº¦)           â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  æ”¯æŒï¼š1ä¸‡+ å¥—é¤ã€æ¨¡ç³ŠåŒ¹é…ã€æ‹¼å†™çº é”™                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ§  äºŒçº§æ„å›¾è¯†åˆ« (100ms) - ç²¾å‡†åˆ†ç±»                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ç­–ç•¥1: è§„åˆ™åŒ¹é… (80%åœºæ™¯, 5ms)              â”‚        â”‚
â”‚  â”‚  - é«˜é¢‘æ¨¡å¼: "åŠç†+å¥—é¤å" â†’ change_package   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚            â†“ æœªå‘½ä¸­                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ç­–ç•¥2: åˆ†ç±»å™¨ (15%åœºæ™¯, 50ms)               â”‚        â”‚
â”‚  â”‚  - ç›¸åŒå¤§ç±»ä¸‹çš„ç»†åˆ†ç±»: BERTå¾®è°ƒæ¨¡å‹           â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚            â†“ æœªå‘½ä¸­                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ç­–ç•¥3: LLM Function Calling (5%åœºæ™¯, 500ms) â”‚        â”‚
â”‚  â”‚  - åŠ¨æ€é€‰æ‹©5-10ä¸ªç›¸å…³Function                â”‚        â”‚
â”‚  â”‚  - å¤æ‚åœºæ™¯å…œåº•                              â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ“ æ§½ä½å¡«å…… + éªŒè¯ (50ms)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  - å‚æ•°å®Œæ•´æ€§æ£€æŸ¥                            â”‚        â”‚
â”‚  â”‚  - ä¸Šä¸‹æ–‡è¡¥å…¨                                â”‚        â”‚
â”‚  â”‚  - å¤šè½®å¯¹è¯ç®¡ç† (DST)                        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ­ å¯¹è¯ç­–ç•¥ + NLG (100ms)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Policy: ç¡®è®¤/æ‰§è¡Œ/è¿½é—®/æ¨è                 â”‚        â”‚
â”‚  â”‚  NLG: æ¨¡æ¿(80%) + LLM(20%)                  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                      ç»“æ„åŒ–è¾“å‡º
              {intent, entities, action}
```

**å…³é”®å†³ç­–ç‚¹**

```mermaid
graph TB
    Start[ç”¨æˆ·è¾“å…¥] --> Preprocess[é¢„å¤„ç†]
    Preprocess --> L1[ä¸€çº§æ„å›¾åˆ†ç±»]
    
    L1 --> |transaction| Rule1[è§„åˆ™åŒ¹é…]
    L1 --> |query| Rule2[è§„åˆ™åŒ¹é…]
    L1 --> |consultation| Rule3[è§„åˆ™åŒ¹é…]
    
    Rule1 --> |å‘½ä¸­80%| Intent1[change_package]
    Rule1 --> |æœªå‘½ä¸­20%| Classifier[BERTåˆ†ç±»å™¨]
    
    Classifier --> |å‘½ä¸­15%| Intent2[å…·ä½“æ„å›¾]
    Classifier --> |æœªå‘½ä¸­5%| LLM[LLMå…œåº•]
    
    LLM --> Intent3[å…œåº•æ„å›¾]
    
    Intent1 --> Entity[å®ä½“è¯†åˆ«]
    Intent2 --> Entity
    Intent3 --> Entity
    
    Entity --> |å‘é‡æ£€ç´¢| Linked[æ ‡å‡†å®ä½“]
    
    Linked --> Slot[æ§½ä½å¡«å……]
    Slot --> |å®Œæ•´| Execute[æ‰§è¡Œ]
    Slot --> |ç¼ºå¤±| Clarify[è¿½é—®]
    
    Execute --> Response[ç”Ÿæˆå›å¤]
    Clarify --> Response
```

**ä¼˜å…ˆçº§**

| é˜¶æ®µ | åšä»€ä¹ˆ                  | æˆæœ¬ | æ”¶ç›Š  |
| ---- | ----------------------- | ---- | ----- |
| P0   | ä¸€çº§æ„å›¾åˆ†ç±» + å®ä½“é“¾æ¥ | 1å‘¨  | â­â­â­â­â­ |
| P1   | BERTåˆ†ç±»å™¨è®­ç»ƒ          | 1æœˆ  | â­â­â­â­  |
| P2   | å‘é‡æ•°æ®åº“              | 2å‘¨  | â­â­â­   |











